# 喧喧客户端测试

测试场景：
1. 登录场景1：常用场景，用户在固定时间段内随机登录，10 分钟之内陆续登录；
2. 登录场景2：瞬间用户登录测试，10 秒钟大量用户同时登入系统；
3. 登录场景3：用户登录数目逐渐增加的情况，每隔 10 秒钟登录一个用户；
4. 大量一对一聊天；
5. 全体成员讨论组聊天；

测试程序要求：
1. 尽可能支持多的用户测试，提高测试脚本执行效率，[使用 nodejs 子进程来启动多个测试程序](http://www.runoob.com/nodejs/nodejs-process.html)；
2. 测试程序能够输出容易阅读的日志，优化日志的内容，记录当前连接的用户数目，输出一份 json 格式的日志；
3. 测试程序参数定义明确， `--name=value`，`-n value`

脚本：
1. 初始化系统用户：调用 `chat/createUser` 和 `chat/createGroup` 来在系统中创建大量用于测试的账号。
2. 测试脚本；
// 3. 管理测试进程脚本；

初始化系统用户程序参数：
1. `--server, -s`： 测试服务器地址，例：`-s http://127.0.0.1:11443`
2. `--admin, -A`：创建用户使用的管理员账号，例：`-A admin`
3. `--adminpassword, -M`：创建用户使用的管理员密码，例：`-M 123456`
2. `--account, -a`： 测试账号统一前缀，默认`test`，例：`-a test` 会以test1 test2 存入数据库 
3. `--password, -p`：测试账号统一密码，例：`-p 123456`
4. `--user -u`：创建测试账号数量，例：`-u 500`
5. `--port -P`：Socket 连接端口，默认`11444`，例：`-P 11444`
例：npm run create -- -s http://127.0.0.1:11443 -A admin -M 123456 -a test -p 123456 -u 110 -P 11444


测试脚本程序参数：
1. `--server, -s`： 测试服务器地址，例：`-s http://127.0.0.1:11443`
2. `--account, -a`： 测试账号，例：`-a test$`
3. `--password, -p`：测试账号密码，例：`-p 123456`
4. `--range, -r`：登录的用户账号范围，例：`-r 1,100`
5. `--login1, -L`：登录场景1，最晚登录时间，默认10分钟（单位：s），例：`-L 600`
6. `--login2, -O`：登录场景2，登录瞬时可用时间，默认10秒（单位：s），例：`-O 10`
7. `--login3, -G`：登录场景3，每次登录时间间隔，默认10秒钟（单位：s），例：`-G 10`
8. `--reconnect, -R`：用户是否断线重连，默认`false` 例：`-R false`
9. `--port, -P`：Socket 连接端口，默认`11444` 例：`-P 11444`
10.`--verbose, -v`：是否输出额外的信息，默认`false`
<!-- 11.`--log -l`：日志输出等级，默认`2`，例：`-l 2` -->
12.`--one2one -o`：是否测试大量一对一发消息，例：`-o`
13.`--groups -g`：是否测试讨论组发消息，例：`-g`
14.`--activeLevel -A`：用户发消息的活跃程度，需设置了一对一发消息或者发送讨论组消息，默认`0.5`，例：`-A 0.5` 设置 0 - 1 之间，
15.`--testTime -T`：测试脚本执行时间，时间结束会输出相关日志，默认`120`（单位：s），例：`-T 120`
例：
场景1：npm run test -- -s http://127.0.0.1:11443 -a xxtest$ -p 123456 -r 1,99 -L 600 -R -P 11444 -o -g 5c18fa42-6886-4342-7f1b-15803a8203d1 -A 0.6 -T 1200
场景2：npm run test -- -s http://127.0.0.1:11443 -a xxtest$ -p 123456 -r 1,99 -O 10 -R -P 11444 -o -g 5c18fa42-6886-4342-7f1b-15803a8203d1 -A 0.5 -T 120
场景3：npm run test -- -s http://127.0.0.1:11443 -a xxtest$ -p 123456 -r 1,99 -G 10 -R -P 11444 -o -g 5c18fa42-6886-4342-7f1b-15803a8203d1 -A 0.8 -T 120

测试用户：
1. 账号密码
2. 活跃程度，`0~1`，如果是 `0`，表示用户在系统里面不发送消息，如果是 `1`，表示每次可以发送消息时必发送消息；

日志：
1. 将控制台输出的内容输出到文件
2. 统计报表
   1. 配置
   2. 概要统计
      * 登录场景
      * 登录用户数目
      * 在线用户数目
      * 所有用户登录完成耗时（平均登录耗时，最小，最大）
      * 断线次数
      * 重连次数
      * 请求耗时（最低值，平均值，最高值）
      * 响应耗时（最低值，平均值，最高值）
      * 发送聊天消息数目（成功数目、失败数目）
   3. 用户清单
      * 用户名
      * 登录的时间
      * 登录耗时
      * 断线次数
      * 重连次数
      * 请求次数（成功数目，失败数目）
      * 请求耗时（最低值，平均值，最高值）
      * 响应耗时（最低值，平均值，最高值）
      * 发送聊天消息数目（成功数目、失败数目）
